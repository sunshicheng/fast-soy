# æ·»åŠ é¡µé¢å¿«é€ŸæŒ‡å—

## ğŸš€ å¿«é€Ÿå¼€å§‹

æœ¬æ–‡æ¡£æä¾›æ·»åŠ æ–°é¡µé¢çš„å®Œæ•´æ­¥éª¤å’Œç¤ºä¾‹ã€‚

---

## æ–¹æ³•ä¸€ï¼šä½¿ç”¨æ–‡ä»¶è·¯ç”±ç³»ç»Ÿï¼ˆæ¨èï¼‰

### æ­¥éª¤æ¦‚è§ˆ

1. âœ… åˆ›å»ºé¡µé¢æ–‡ä»¶
2. âœ… è¿è¡Œè·¯ç”±ç”Ÿæˆå‘½ä»¤
3. âœ… æ·»åŠ å›½é™…åŒ–æ–‡æœ¬
4. âœ… æ·»åŠ  API æ¥å£ï¼ˆå¦‚éœ€è¦ï¼‰
5. âœ… åç«¯é…ç½®èœå•ï¼ˆåŠ¨æ€è·¯ç”±æ¨¡å¼ï¼‰

---

## å®Œæ•´ç¤ºä¾‹ï¼šæ·»åŠ "äº§å“ç®¡ç†"é¡µé¢

### æ­¥éª¤ 1: åˆ›å»ºé¡µé¢æ–‡ä»¶

åœ¨ `src/views/` ä¸‹åˆ›å»ºç›®å½•å’Œæ–‡ä»¶ï¼š

```
src/views/
â””â”€â”€ product/
    â”œâ”€â”€ index.vue          # äº§å“åˆ—è¡¨é¡µ
    â””â”€â”€ modules/
        â””â”€â”€ product-form.vue # äº§å“è¡¨å•ç»„ä»¶ï¼ˆå¯é€‰ï¼‰
```

**æ–‡ä»¶å†…å®¹** (`src/views/product/index.vue`):

```vue
<script setup lang="tsx">
import { NButton, NCard, NDataTable, NPopconfirm } from 'naive-ui';
import { $t } from '@/locales';
import { useTable } from '@/hooks/common/table';
// å¯¼å…¥ APIï¼ˆç¨ååˆ›å»ºï¼‰
// import { fetchGetProductList, fetchDeleteProduct } from '@/service/api';

defineOptions({
  name: 'Product'
});

// ä½¿ç”¨ useTable hook ç®¡ç†è¡¨æ ¼
const {
  columns,
  data,
  loading,
  getData,
  pagination,
  searchParams,
  resetSearchParams
} = useTable({
  // apiFn: fetchGetProductList,  // API å‡½æ•°
  apiFn: async () => {
    // ä¸´æ—¶æ¨¡æ‹Ÿæ•°æ®
    return {
      data: {
        total: 0,
        list: []
      },
      error: null
    };
  },
  columns: () => [
    {
      key: 'index',
      title: $t('common.index'),
      align: 'center',
      width: 64
    },
    {
      key: 'name',
      title: 'äº§å“åç§°',
      align: 'center'
    },
    {
      key: 'price',
      title: 'ä»·æ ¼',
      align: 'center'
    },
    {
      key: 'status',
      title: 'çŠ¶æ€',
      align: 'center',
      render: (row: any) => (
        <NTag type={row.status === 1 ? 'success' : 'default'}>
          {row.status === 1 ? 'å¯ç”¨' : 'ç¦ç”¨'}
        </NTag>
      )
    },
    {
      key: 'action',
      title: $t('common.action'),
      align: 'center',
      width: 200,
      render: (row: any) => (
        <div class="flex justify-center gap-8px">
          <NButton size="small" onClick={() => handleEdit(row)}>
            {$t('common.edit')}
          </NButton>
          <NPopconfirm onPositiveClick={() => handleDelete(row)}>
            {{
              trigger: () => (
                <NButton size="small" type="error">
                  {$t('common.delete')}
                </NButton>
              ),
              default: () => $t('common.confirmDelete')
            }}
          </NPopconfirm>
        </div>
      )
    }
  ],
  apiParams: {
    current: 1,
    size: 10,
    name: null,  // æœç´¢å‚æ•°
    status: null
  }
});

function handleEdit(row: any) {
  // TODO: ç¼–è¾‘é€»è¾‘
  console.log('ç¼–è¾‘', row);
}

async function handleDelete(row: any) {
  // TODO: åˆ é™¤é€»è¾‘
  // await fetchDeleteProduct(row.id);
  // await getData();
  console.log('åˆ é™¤', row);
}

// æ·»åŠ äº§å“
function handleAdd() {
  // TODO: æ·»åŠ é€»è¾‘
  console.log('æ·»åŠ äº§å“');
}
</script>

<template>
  <div class="flex-col gap-16px p-16px">
    <NCard :bordered="false">
      <template #header>
        <span class="text-18px font-500">äº§å“ç®¡ç†</span>
      </template>
      <template #header-extra>
        <NButton type="primary" @click="handleAdd">
          {{ $t('common.add') }}
        </NButton>
      </template>

      <!-- æœç´¢è¡¨å•ï¼ˆå¯é€‰ï¼‰ -->
      <div class="mb-16px">
        <NForm
          :model="searchParams"
          label-placement="left"
          :label-width="80"
          inline
        >
          <NFormItem label="äº§å“åç§°">
            <NInput
              v-model:value="searchParams.name"
              placeholder="è¯·è¾“å…¥äº§å“åç§°"
              clearable
            />
          </NFormItem>
          <NFormItem>
            <NButton type="primary" @click="getData">
              {{ $t('common.search') }}
            </NButton>
            <NButton class="ml-8px" @click="resetSearchParams">
              {{ $t('common.reset') }}
            </NButton>
          </NFormItem>
        </NForm>
      </div>

      <!-- æ•°æ®è¡¨æ ¼ -->
      <NDataTable
        :columns="columns"
        :data="data"
        :loading="loading"
        :pagination="pagination"
        @update:page="getData"
        @update:page-size="getData"
      />
    </NCard>
  </div>
</template>

<style scoped></style>
```

### æ­¥éª¤ 2: è¿è¡Œè·¯ç”±ç”Ÿæˆå‘½ä»¤

```bash
cd web
pnpm gen-route
```

è¿™ä¸ªå‘½ä»¤ä¼šï¼š
- è‡ªåŠ¨æ‰«æ `src/views/product/index.vue`
- ç”Ÿæˆè·¯ç”±é…ç½®åˆ° `src/router/elegant/routes.ts`
- ç”Ÿæˆè·¯ç”±å¯¼å…¥åˆ° `src/router/elegant/imports.ts`

ç”Ÿæˆçš„è·¯ç”±é…ç½®ï¼š
```typescript
{
  name: 'product',
  path: '/product',
  component: 'layout.base$view.product',
  meta: {
    title: 'product',
    i18nKey: 'route.product'
  }
}
```

### æ­¥éª¤ 3: æ·»åŠ èœå•é…ç½®ï¼ˆé™æ€è·¯ç”±æ¨¡å¼ï¼‰

ç¼–è¾‘ `src/router/routes/index.ts`ï¼Œåœ¨ `customRoutes` ä¸­æ·»åŠ ï¼š

```typescript
const customRoutes: CustomRoute[] = [
  // ... å…¶ä»–è·¯ç”±
  {
    name: 'product',
    path: '/product',
    component: 'layout.base$view.product',
    meta: {
      title: 'product',
      i18nKey: 'route.product',
      icon: 'mdi:package-variant',  // å›¾æ ‡
      order: 10  // èœå•é¡ºåº
    }
  }
];
```

### æ­¥éª¤ 4: æ·»åŠ å›½é™…åŒ–æ–‡æœ¬

ç¼–è¾‘ `src/locales/langs/zh-cn.ts`:

```typescript
const local: App.I18n.Schema = {
  route: {
    product: 'äº§å“ç®¡ç†',
    // ...
  },
  // ...
};
```

ç¼–è¾‘ `src/locales/langs/en-us.ts`:

```typescript
const local: App.I18n.Schema = {
  route: {
    product: 'Product Management',
    // ...
  },
  // ...
};
```

### æ­¥éª¤ 5: æ·»åŠ  API æ¥å£ï¼ˆå¦‚éœ€è¦ï¼‰

#### 5.1 åˆ›å»º API æ–‡ä»¶

`src/service/api/product.ts`:

```typescript
import { request } from '../request';

/** è·å–äº§å“åˆ—è¡¨ */
export function fetchGetProductList(data?: Api.Product.SearchParams) {
  return request<Api.Product.List>({
    url: '/product/list',
    method: 'post',
    data
  });
}

/** è·å–äº§å“è¯¦æƒ… */
export function fetchGetProductDetail(id: number) {
  return request<Api.Product.Detail>({
    url: `/product/${id}`,
    method: 'get'
  });
}

/** åˆ›å»ºäº§å“ */
export function fetchCreateProduct(data: Api.Product.Create) {
  return request({
    url: '/product',
    method: 'post',
    data
  });
}

/** æ›´æ–°äº§å“ */
export function fetchUpdateProduct(id: number, data: Api.Product.Update) {
  return request({
    url: `/product/${id}`,
    method: 'patch',
    data
  });
}

/** åˆ é™¤äº§å“ */
export function fetchDeleteProduct(id: number) {
  return request({
    url: `/product/${id}`,
    method: 'delete'
  });
}
```

#### 5.2 å¯¼å‡º API

ç¼–è¾‘ `src/service/api/index.ts`:

```typescript
export * from './auth';
export * from './route';
export * from './system-manage';
export * from './product';  // æ–°å¢
```

#### 5.3 æ·»åŠ ç±»å‹å®šä¹‰

ç¼–è¾‘ `src/typings/api.d.ts`:

```typescript
declare namespace Api {
  // ... å…¶ä»–å‘½åç©ºé—´
  
  namespace Product {
    interface SearchParams {
      current?: number;
      size?: number;
      name?: string;
      status?: number;
    }
    
    interface List {
      total: number;
      list: Item[];
    }
    
    interface Item {
      id: number;
      name: string;
      price: number;
      status: number;
      createTime: string;
      updateTime: string;
    }
    
    interface Detail extends Item {
      description?: string;
      // ... å…¶ä»–å­—æ®µ
    }
    
    interface Create {
      name: string;
      price: number;
      status?: number;
      description?: string;
    }
    
    interface Update {
      name?: string;
      price?: number;
      status?: number;
      description?: string;
    }
  }
}
```

#### 5.4 åœ¨é¡µé¢ä¸­ä½¿ç”¨ API

æ›´æ–° `src/views/product/index.vue`:

```typescript
import { fetchGetProductList, fetchDeleteProduct } from '@/service/api';

const {
  // ...
} = useTable({
  apiFn: fetchGetProductList,  // ä½¿ç”¨çœŸå® API
  // ...
});

async function handleDelete(row: Api.Product.Item) {
  await fetchDeleteProduct(row.id);
  await getData();
}
```

### æ­¥éª¤ 6: åç«¯é…ç½®èœå•ï¼ˆåŠ¨æ€è·¯ç”±æ¨¡å¼ï¼‰

å¦‚æœä½¿ç”¨**åŠ¨æ€è·¯ç”±æ¨¡å¼**ï¼Œéœ€è¦åœ¨åç«¯æ•°æ®åº“ä¸­é…ç½®èœå•ï¼š

1. **ç™»å½•åç«¯ç®¡ç†ç³»ç»Ÿ**
2. **è¿›å…¥èœå•ç®¡ç†**
3. **æ·»åŠ èœå•**:
   - èœå•åç§°: `äº§å“ç®¡ç†`
   - è·¯ç”±åç§°: `product`
   - è·¯ç”±è·¯å¾„: `/product`
   - ç»„ä»¶: `view.product`
   - å›¾æ ‡: `mdi:package-variant`
   - æ’åº: `10`

åç«¯ä¼šè‡ªåŠ¨è¿”å›èœå•é…ç½®ï¼Œå‰ç«¯ä¼šåŠ¨æ€æ³¨å†Œè·¯ç”±ã€‚

---

## æ–¹æ³•äºŒï¼šæ·»åŠ å­é¡µé¢ï¼ˆè¯¦æƒ…é¡µã€ç¼–è¾‘é¡µç­‰ï¼‰

### ç¤ºä¾‹ï¼šæ·»åŠ äº§å“è¯¦æƒ…é¡µ

#### 1. åˆ›å»ºè¯¦æƒ…é¡µæ–‡ä»¶

`src/views/product/detail/[id].vue`:

```vue
<script setup lang="ts">
import { ref, onMounted } from 'vue';
import { useRoute, useRouter } from 'vue-router';
import { NButton, NCard, NDescriptions, NDescriptionsItem } from 'naive-ui';
import { $t } from '@/locales';
// import { fetchGetProductDetail } from '@/service/api';

defineOptions({
  name: 'ProductDetail'
});

const route = useRoute();
const router = useRouter();
const productId = route.params.id as string;

const product = ref<Api.Product.Detail | null>(null);
const loading = ref(false);

async function loadDetail() {
  loading.value = true;
  try {
    // const { data } = await fetchGetProductDetail(Number(productId));
    // product.value = data;
    
    // ä¸´æ—¶æ•°æ®
    product.value = {
      id: Number(productId),
      name: 'ç¤ºä¾‹äº§å“',
      price: 100,
      status: 1,
      createTime: new Date().toISOString(),
      updateTime: new Date().toISOString()
    };
  } finally {
    loading.value = false;
  }
}

onMounted(() => {
  loadDetail();
});

function handleBack() {
  router.back();
}
</script>

<template>
  <div class="flex-col gap-16px p-16px">
    <NCard :bordered="false" title="äº§å“è¯¦æƒ…">
      <template #header-extra>
        <NButton @click="handleBack">{{ $t('common.back') }}</NButton>
      </template>
      
      <NDescriptions :column="2" v-if="product">
        <NDescriptionsItem label="äº§å“ID">
          {{ product.id }}
        </NDescriptionsItem>
        <NDescriptionsItem label="äº§å“åç§°">
          {{ product.name }}
        </NDescriptionsItem>
        <NDescriptionsItem label="ä»·æ ¼">
          Â¥{{ product.price }}
        </NDescriptionsItem>
        <NDescriptionsItem label="çŠ¶æ€">
          <NTag :type="product.status === 1 ? 'success' : 'default'">
            {{ product.status === 1 ? 'å¯ç”¨' : 'ç¦ç”¨' }}
          </NTag>
        </NDescriptionsItem>
      </NDescriptions>
    </NCard>
  </div>
</template>
```

#### 2. è¿è¡Œè·¯ç”±ç”Ÿæˆ

```bash
pnpm gen-route
```

ç”Ÿæˆçš„è·¯ç”±ï¼š
```typescript
{
  name: 'product_detail',
  path: '/product/detail/:id',
  component: 'view.product_detail',
  props: true,
  meta: {
    title: 'product_detail',
    i18nKey: 'route.product_detail',
    hideInMenu: true,  // ä¸åœ¨èœå•ä¸­æ˜¾ç¤º
    activeMenu: 'product'  // æ¿€æ´»çˆ¶èœå•
  }
}
```

#### 3. æ·»åŠ å›½é™…åŒ–

```typescript
route: {
  product_detail: 'äº§å“è¯¦æƒ…'
}
```

#### 4. åœ¨åˆ—è¡¨é¡µæ·»åŠ è·³è½¬

```typescript
import { useRouterPush } from '@/hooks/common/router';

const { routerPush } = useRouterPush();

function handleViewDetail(row: Api.Product.Item) {
  routerPush({
    name: 'product_detail',
    params: { id: row.id }
  });
}
```

---

## æ–¹æ³•ä¸‰ï¼šæ·»åŠ å¸¦è¡¨å•çš„é¡µé¢

### åˆ›å»ºè¡¨å•ç»„ä»¶

`src/views/product/modules/product-form.vue`:

```vue
<script setup lang="ts">
import { ref, watch } from 'vue';
import { NForm, NFormItem, NInput, NInputNumber, NSelect, NButton } from 'naive-ui';
import type { FormInst } from 'naive-ui';
import { $t } from '@/locales';

interface Props {
  modelValue: boolean;
  data?: Api.Product.Item;
}

interface Emits {
  (e: 'update:modelValue', value: boolean): void;
  (e: 'success'): void;
}

const props = defineProps<Props>();
const emit = defineEmits<Emits>();

const formRef = ref<FormInst | null>(null);
const loading = ref(false);

const formModel = ref({
  name: '',
  price: 0,
  status: 1,
  description: ''
});

const rules = {
  name: {
    required: true,
    message: 'è¯·è¾“å…¥äº§å“åç§°',
    trigger: 'blur'
  },
  price: {
    required: true,
    type: 'number',
    min: 0,
    message: 'è¯·è¾“å…¥ä»·æ ¼',
    trigger: 'blur'
  }
};

const statusOptions = [
  { label: 'å¯ç”¨', value: 1 },
  { label: 'ç¦ç”¨', value: 0 }
];

watch(() => props.modelValue, (val) => {
  if (val && props.data) {
    // ç¼–è¾‘æ¨¡å¼ï¼Œå¡«å……æ•°æ®
    formModel.value = {
      name: props.data.name,
      price: props.data.price,
      status: props.data.status,
      description: props.data.description || ''
    };
  } else if (val) {
    // æ–°å¢æ¨¡å¼ï¼Œé‡ç½®è¡¨å•
    formModel.value = {
      name: '',
      price: 0,
      status: 1,
      description: ''
    };
  }
});

async function handleSubmit() {
  await formRef.value?.validate();
  
  loading.value = true;
  try {
    // TODO: è°ƒç”¨ API
    // if (props.data) {
    //   await fetchUpdateProduct(props.data.id, formModel.value);
    // } else {
    //   await fetchCreateProduct(formModel.value);
    // }
    
    window.$message?.success(props.data ? $t('common.modifySuccess') : $t('common.addSuccess'));
    emit('success');
    handleCancel();
  } finally {
    loading.value = false;
  }
}

function handleCancel() {
  emit('update:modelValue', false);
}
</script>

<template>
  <NModal
    :show="modelValue"
    :title="data ? 'ç¼–è¾‘äº§å“' : 'æ–°å¢äº§å“'"
    preset="card"
    style="width: 600px"
    @update:show="handleCancel"
  >
    <NForm
      ref="formRef"
      :model="formModel"
      :rules="rules"
      label-placement="left"
      :label-width="80"
    >
      <NFormItem label="äº§å“åç§°" path="name">
        <NInput v-model:value="formModel.name" placeholder="è¯·è¾“å…¥äº§å“åç§°" />
      </NFormItem>
      
      <NFormItem label="ä»·æ ¼" path="price">
        <NInputNumber
          v-model:value="formModel.price"
          :min="0"
          :precision="2"
          placeholder="è¯·è¾“å…¥ä»·æ ¼"
          style="width: 100%"
        />
      </NFormItem>
      
      <NFormItem label="çŠ¶æ€" path="status">
        <NSelect
          v-model:value="formModel.status"
          :options="statusOptions"
          placeholder="è¯·é€‰æ‹©çŠ¶æ€"
        />
      </NFormItem>
      
      <NFormItem label="æè¿°" path="description">
        <NInput
          v-model:value="formModel.description"
          type="textarea"
          placeholder="è¯·è¾“å…¥æè¿°"
          :rows="4"
        />
      </NFormItem>
    </NForm>
    
    <template #footer>
      <div class="flex justify-end gap-8px">
        <NButton @click="handleCancel">{{ $t('common.cancel') }}</NButton>
        <NButton type="primary" :loading="loading" @click="handleSubmit">
          {{ $t('common.confirm') }}
        </NButton>
      </div>
    </template>
  </NModal>
</template>
```

### åœ¨åˆ—è¡¨é¡µä¸­ä½¿ç”¨è¡¨å•

```vue
<script setup lang="tsx">
// ... å…¶ä»–ä»£ç 

const showForm = ref(false);
const formData = ref<Api.Product.Item | undefined>();

function handleAdd() {
  formData.value = undefined;
  showForm.value = true;
}

function handleEdit(row: Api.Product.Item) {
  formData.value = row;
  showForm.value = true;
}

function handleFormSuccess() {
  getData(); // åˆ·æ–°åˆ—è¡¨
}
</script>

<template>
  <!-- ... å…¶ä»–å†…å®¹ -->
  
  <ProductForm
    v-model:model-value="showForm"
    :data="formData"
    @success="handleFormSuccess"
  />
</template>
```

---

## è·¯ç”±é…ç½®è¯´æ˜

### è·¯ç”± Meta é…ç½®

```typescript
meta: {
  title: 'product',              // è·¯ç”±æ ‡é¢˜
  i18nKey: 'route.product',      // å›½é™…åŒ– key
  icon: 'mdi:package-variant',   // å›¾æ ‡
  order: 10,                      // èœå•é¡ºåº
  roles: ['R_ADMIN'],            // æƒé™è§’è‰²ï¼ˆå¯é€‰ï¼‰
  hideInMenu: true,              // éšè—èœå•ï¼ˆå¯é€‰ï¼‰
  activeMenu: 'product',         // æ¿€æ´»çš„çˆ¶èœå•ï¼ˆå¯é€‰ï¼‰
  keepAlive: true,               // ç¼“å­˜é¡µé¢ï¼ˆå¯é€‰ï¼‰
  multiTab: true                 // å¤šæ ‡ç­¾é¡µï¼ˆå¯é€‰ï¼‰
}
```

### è·¯ç”±ç±»å‹

1. **å¸¸é‡è·¯ç”±** (`constant: true`): ä¸éœ€è¦ç™»å½•
   - ç™»å½•é¡µã€404ã€500 ç­‰

2. **è®¤è¯è·¯ç”±**: éœ€è¦ç™»å½•
   - ä¸šåŠ¡é¡µé¢

3. **åŠ¨æ€è·¯ç”±**: ä»åç«¯è·å–
   - æ ¹æ®ç”¨æˆ·æƒé™åŠ¨æ€åŠ è½½

---

## å¸¸ç”¨ Hooks

### useTable - è¡¨æ ¼ç®¡ç†

```typescript
const {
  columns,           // è¡¨æ ¼åˆ—é…ç½®
  data,             // è¡¨æ ¼æ•°æ®
  loading,          // åŠ è½½çŠ¶æ€
  getData,          // è·å–æ•°æ®
  getDataByPage,    // åˆ†é¡µè·å–
  pagination,        // åˆ†é¡µé…ç½®
  searchParams,     // æœç´¢å‚æ•°
  resetSearchParams // é‡ç½®æœç´¢
} = useTable({
  apiFn: fetchGetProductList,
  apiParams: {
    current: 1,
    size: 10,
    name: null
  },
  columns: () => [/* åˆ—é…ç½® */]
});
```

### useRouterPush - è·¯ç”±è·³è½¬

```typescript
const { routerPush, routerReplace } = useRouterPush();

// è·³è½¬
routerPush({
  name: 'product_detail',
  params: { id: 1 }
});

// æ›¿æ¢
routerReplace({
  name: 'product'
});
```

### useLoading - åŠ è½½çŠ¶æ€

```typescript
const { loading, startLoading, endLoading } = useLoading();

async function loadData() {
  startLoading();
  try {
    // åŠ è½½æ•°æ®
  } finally {
    endLoading();
  }
}
```

---

## æ£€æŸ¥æ¸…å•

æ·»åŠ æ–°é¡µé¢åï¼Œè¯·æ£€æŸ¥ï¼š

- [ ] é¡µé¢æ–‡ä»¶å·²åˆ›å»º
- [ ] è¿è¡Œäº† `pnpm gen-route` å‘½ä»¤
- [ ] æ·»åŠ äº†å›½é™…åŒ–æ–‡æœ¬ï¼ˆä¸­æ–‡å’Œè‹±æ–‡ï¼‰
- [ ] æ·»åŠ äº† API æ¥å£ï¼ˆå¦‚éœ€è¦ï¼‰
- [ ] æ·»åŠ äº†ç±»å‹å®šä¹‰ï¼ˆå¦‚éœ€è¦ï¼‰
- [ ] åç«¯é…ç½®äº†èœå•ï¼ˆåŠ¨æ€è·¯ç”±æ¨¡å¼ï¼‰
- [ ] è·¯ç”±é…ç½®æ­£ç¡®ï¼ˆé™æ€è·¯ç”±æ¨¡å¼ï¼‰
- [ ] é¡µé¢å¯ä»¥æ­£å¸¸è®¿é—®
- [ ] æƒé™æ§åˆ¶æ­£ç¡®ï¼ˆå¦‚éœ€è¦ï¼‰

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2025-11-06

